<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æˆåŠŸç‡ç®—å‡ºå›</title>

<style>
body {
  font-family: system-ui, -apple-system;
  background: #1e1e2f;
  color: #fff;
  margin: 0;
  padding: 8px;
}

h1 {
  text-align: center;
  margin-bottom: 8px;
  font-size: 18px;
}

/* ===== ãƒ¡ã‚¤ãƒ³ãƒœã‚¿ãƒ³ ===== */
.mainButtons {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

button {
  font-weight: bold;
  border-radius: 10px;
  border: none;
  color: #000;
}

.success {
  background: #ff9933;
  height: 72px;        /* æŠ¼ã—ã‚„ã™ã */
  font-size:18px;
}

.miss {
  background: #66ccff;
  height: 72px;
  font-size:18px;
}

.reset {
  background: #ff6666;
  height: 48px;
  flex:1;
}

.soundToggle {
  background: #66dd88;
  width:90px;
  height:48px;
  font-size:14px;
}

button:active { opacity:0.7; }

/* ===== å…¥åŠ›æ¬„ ===== */
.inputSection {
  border: 2px solid #fff;
  border-radius: 10px;
  padding: 8px;
  margin: 8px 0;
}

.inputBox {
  width: 100%;
  height: 38px;
  font-size: 18px;
  text-align: right;
  border-radius: 6px;
  border: 2px solid #fff;
  background: #1e1e2f;
  color: #fff;
  margin-bottom: 6px;

  /* â˜… ã‚ºãƒ¬è§£æ¶ˆã®æ±ºå®šæ‰“ */
  box-sizing: border-box;
}

/* ===== ãƒ†ãƒ³ã‚­ãƒ¼ ===== */
.keypad {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 6px;
}

.keypad button {
  height: 40px;
  font-size: 16px;
  background: #bbbbbb;
  border-radius: 6px;
}

/* ===== çµæœ ===== */
.footer {
  background: #2b2b44;
  padding: 10px;
  border-radius: 8px;
  text-align: center;
}

.value { font-size:15px; }
.rate { font-size:26px; font-weight:bold; }
.ci { font-size:13px; color:#ffeeaa; }

/* ===== ãƒ¡ãƒ¢ ===== */
.memoSection {
  border: 2px solid #fff;
  border-radius: 10px;
  padding: 6px;
  margin-top: 8px;
}

.memoSection textarea {
  width: 100%;
  height: 60px;
  font-size: 15px;
  border: none;
  background: #1e1e2f;
  color: #fff;
  resize: none;
  box-sizing: border-box;
}

/* ===== ãƒªã‚»ãƒƒãƒˆï¼‹éŸ³ ===== */
.resetSoundWrapper {
  display:flex;
  gap:6px;
  margin:8px 0;
}
</style>
</head>

<body>
<h1>æˆåŠŸç‡ç®—å‡ºå›</h1>

<div class="mainButtons">
  <button class="success" onclick="addSuccess()">æˆåŠŸ</button>
  <button class="miss" onclick="addMiss()">ãƒŸã‚¹</button>
</div>

<div class="inputSection">
  <input id="inputValue" class="inputBox" type="text" placeholder="æ•°å€¤å…¥åŠ›" readonly>
  <div class="keypad">
    <button onclick="addNum(1)">1</button>
    <button onclick="addNum(2)">2</button>
    <button onclick="addNum(3)">3</button>
    <button onclick="addNum(4)">4</button>
    <button onclick="addNum(5)">5</button>
    <button onclick="addNum(6)">6</button>
    <button onclick="addNum(7)">7</button>
    <button onclick="addNum(8)">8</button>
    <button onclick="addNum(9)">9</button>
    <button onclick="clearNum()">C</button>
    <button onclick="addNum(0)">0</button>
    <button onclick="backspace()">â†</button>
  </div>
</div>

<div class="footer">
  <div class="value">æˆåŠŸï¼š<span id="success">0</span></div>
  <div class="value">ãƒŸã‚¹ï¼š<span id="miss">0</span></div>
  <div class="rate">æˆåŠŸç‡ï¼š<span id="rate">0.0</span>%</div>
  <div class="ci">95% ä¿¡é ¼åŒºé–“ï¼š<span id="ci">0.0 - 0.0</span>%</div>
</div>

<div class="resetSoundWrapper">
  <button class="reset" onclick="resetAll()">ãƒªã‚»ãƒƒãƒˆ</button>
  <button class="soundToggle" onclick="toggleSound()">ğŸ”Š éŸ³ON</button>
</div>

<div class="memoSection">
  <textarea id="memo" placeholder="ãƒ¡ãƒ¢"></textarea>
</div>

<script>
const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
let soundOn=true;
function playTone(f,d=0.1,v=0.25){
  if(!soundOn)return;
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.frequency.value=f; g.gain.value=v;
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+d);
}
function playOK(){playTone(880,0.12,0.3);}
function playNG(){playTone(440,0.12,0.25);}
function toggleSound(){
  soundOn=!soundOn;
  document.querySelector(".soundToggle").textContent=soundOn?"ğŸ”Š éŸ³ON":"ğŸ”‡ éŸ³OFF";
}

let success=0, miss=0;
function getInputValue(){return Number(document.getElementById("inputValue").value)||1;}

function update(){
  const t=success+miss;
  document.getElementById("rate").textContent=t?(success/t*100).toFixed(1):"0.0";
  if(!t){document.getElementById("ci").textContent="0.0 - 0.0";return;}
  const p=success/t,se=Math.sqrt(p*(1-p)/t);
  document.getElementById("ci").textContent=
    `${Math.max(0,(p-1.96*se)*100).toFixed(1)} - ${Math.min(100,(p+1.96*se)*100).toFixed(1)}`;
}

function addSuccess(){playOK();success+=getInputValue();document.getElementById("success").textContent=success;update();clearNum();}
function addMiss(){playNG();miss+=getInputValue();document.getElementById("miss").textContent=miss;update();clearNum();}
function resetAll(){playNG();success=miss=0;document.getElementById("success").textContent=0;document.getElementById("miss").textContent=0;update();clearNum();document.getElementById("memo").value="";}

function addNum(n){inputValue.value+=n;}
function clearNum(){inputValue.value="";}
function backspace(){inputValue.value=inputValue.value.slice(0,-1);}
</script>
</body>
</html>
